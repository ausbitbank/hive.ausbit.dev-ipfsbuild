(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{"319c":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"flex q-pa-md flex-center"},[n("q-card",{staticClass:"text-center",attrs:{dense:""}},[n("q-card-section",[n("p",[t._v("Abuse fighting tool. Select a user, find and attempt to remove payouts.")]),n("p",{staticClass:"text-italic text-bold text-red"},[t._v("Alpha, buggy, don't use if you don't understand the risks.")]),n("q-input",{attrs:{label:"username"},model:{value:t.usernameField,callback:function(e){t.usernameField=e},expression:"usernameField"}}),n("q-btn",{staticClass:"q-ma-md",attrs:{label:"Find pending payouts",color:"primary",bordered:"",glossy:""},on:{click:function(e){return t.lookup(t.usernameField)}}}),t.loggedInUser?n("div",[t._v("\n          Downvote Power for "+t._s(t.loggedInUser)+"\n          "),n("q-linear-progress",{attrs:{dark:"",stripe:"",rounded:"",size:"20px",value:this.downvotePowerPct/100,color:"red"}},[n("div",{staticClass:"absolute-full flex flex-center"},[n("q-badge",{attrs:{color:"black","text-color":"primary",label:this.downvotePowerPct}})],1)]),n("q-btn",{staticClass:"q-ma-sm",attrs:{title:"Refresh logged in account data",size:"sm",round:"",color:"green",icon:"refresh"}})],1):t._e()],1),t.posts.length>0?n("q-card-section",{attrs:{dense:""}},[n("h5",[t._v("Pending payouts for "+t._s(t.username))]),t.loggedInUser?n("q-btn",{attrs:{color:"red",flat:"",label:"Downvote all",icon:"thumb_down"},on:{click:function(e){return t.downvoteAll()}}}):t._e(),n("q-list",{attrs:{flat:"",bordered:"",separator:""}},t._l(t.postsWithPayoutNotVoted,(function(e){return n("q-item",{key:e.index},[n("q-item-section",[n("router-link",{attrs:{to:t.returnPostLink(e.author,e.permlink)}},[n("q-icon",{attrs:{name:"link"}}),t._v(" "+t._s(e.permlink.substr(0,50)))],1),t._v(" Pays out $"+t._s(e.payout)+" "+t._s(t.timeDelta(e.payout_at))+"\n            "),n("q-table",{attrs:{data:e.active_votes,columns:t.voteColumns,pagination:{sortBy:"rshares",descending:!0,rowsPerPage:5},dense:"",bordered:"",separator:"cell"}}),t.loggedInUser?n("q-btn",{attrs:{color:"warning",icon:"thumb_down",flat:""},on:{click:function(n){t.vote(e.author,e.permlink,t.calcWeightForRshares(e.net_rshares))}}},[t._v("   Downvote "+t._s(t.calcWeightForRshares(e.net_rshares))+" %")]):t._e()],1)],1)})),1),t.loggedInUser&&t.postsWithPayoutVoted.length>0?n("q-expansion-item",{attrs:{"expand-separator":"",label:"Pending payouts with my vote already"}},[n("q-list",{attrs:{flat:"",bordered:"",separator:""}},t._l(t.postsWithPayoutVoted,(function(e){return n("q-item",{key:e.index},[n("q-item-section",[n("router-link",{attrs:{to:t.returnPostLink(e.author,e.permlink)}},[n("q-icon",{attrs:{name:"link"}}),t._v(" "+t._s(e.permlink.substr(0,50)))],1),t._v(" Pays out $"+t._s(e.payout)+" "+t._s(t.timeDelta(e.payout_at))+"\n            "),n("q-table",{attrs:{data:e.active_votes,columns:t.voteColumns,pagination:{sortBy:"rshares",descending:!0,rowsPerPage:5},dense:"",bordered:"",separator:"cell"}}),t.loggedInUser?n("q-btn",{attrs:{color:"warning",icon:"thumb_down",flat:""},on:{click:function(n){t.vote(e.author,e.permlink,t.calcWeightForRshares(e.net_rshares))}}},[t._v("   Downvote "+t._s(t.calcWeightForRshares(e.net_rshares))+" %")]):t._e()],1)],1)})),1)],1):t._e()],1):t._e()],1)],1)},s=[],o=n("967e"),a=n.n(o),i=(n("96cf"),n("fa84")),c=n.n(i),u=(n("28a5"),n("c1df")),l=n.n(u),d={name:"Downvoter",components:{},data:function(){return{usernameField:"",username:"",posts:[],rewardFundPost:null,median:null,voteColumns:[{name:"voter",label:"Voter",field:"voter",sortable:!0},{name:"rshares",label:"rshares",field:"rshares",sortable:!0}]}},computed:{loggedInUser:{get:function(){return this.$store.state.hive.user.username}},account:{get:function(){return this.loggedInUser?this.$store.state.hive.accounts[this.loggedInUser]:null}},effectiveVests:function(){return void 0!==this.account&&null!==this.account?parseInt(this.account.vesting_shares.split(" ")[0])+parseInt(this.account.received_vesting_shares.split(" ")[0])-parseInt(this.account.delegated_vesting_shares.split(" ")[0])-parseInt(this.account.vesting_withdraw_rate.split(" ")[0]):null},downvotePower:function(){return void 0!==this.account?this.account.downvote_manabar.current_mana/(this.effectiveVests/4*1e4)*100:null},downvotePowerPct:function(){if(void 0!==this.account){var t=(this.downvotePower/100).toFixed(2);return t>100&&(t=100),t}return null},postsWithPayoutNotVoted:function(){var t=this;return this.posts.length>0?this.posts.filter((function(e){return e.net_rshares>0&&0===e.active_votes.filter((function(e){return e.voter===t.loggedInUser})).length})):[]},postsWithPayoutVoted:function(){var t=this;return this.posts.length>0?this.posts.filter((function(e){return e.net_rshares>0&&0!==e.active_votes.filter((function(e){return e.voter===t.loggedInUser})).length})):[]}},methods:{sortPostsByAge:function(){this.posts.sort((function(t,e){return l()(t.created)-l()(e.created)}))},downvoteAll:function(){var t=this;this.posts.filter((function(e){return e.net_rshares>0&&0===e.active_votes.filter((function(e){return e.voter===t.loggedInUser})).length})).forEach((function(e){t.downvotePost(e)}))},downvotePost:function(t){this.vote(t.author,t.permlink,this.calcWeightForRshares(t.net_rshares))},calcWeightForRshares:function(t){var e=parseFloat(this.account.vesting_shares.split(" ")[0]),n=parseFloat(this.account.received_vesting_shares.split(" ")[0]),r=parseFloat(this.account.delegated_vesting_shares.split(" ")[0]),s=e+n-r,o=1e6*s,a=1e4,i=this.downvotePower*a/1e4/50,c=i*o/1e4;if(t<c){var u=parseInt(t/c*100);return 0===u&&(u=1),-Math.abs(u)}return-100},lookup:function(t){var e=this;return c()(a.a.mark((function n(){var r;return a.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.username=t.toLowerCase(),e.posts=[],r={account:e.username,sort:"payout"},e.$hive.api.callAsync("bridge.get_account_posts",r).then((function(t){e.posts=t,e.sortPostsByAge()}));case 4:case"end":return n.stop()}}),n)})))()},vote:function(t,e,n){var r=this;return c()(a.a.mark((function s(){return a.a.wrap((function(s){while(1)switch(s.prev=s.next){case 0:r.$store.commit("hive/addToQueue",[r.loggedInUser,"posting",["vote",{voter:r.loggedInUser,weight:100*n,author:t,permlink:e}]]);case 1:case"end":return s.stop()}}),s)})))()},getRewardFundPost:function(){var t=this;return c()(a.a.mark((function e(){return a.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$hive.api.getRewardFund("post",function(t,e){t&&console.log(t),this.rewardFundPost=e}.bind(t));case 1:case"end":return e.stop()}}),e)})))()},getMedianPrice:function(){var t=this;return c()(a.a.mark((function e(){return a.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$hive.api.getCurrentMedianHistoryPrice(function(t,e){t&&console.error(t),e&&(this.median=e)}.bind(t));case 1:case"end":return e.stop()}}),e)})))()},timeDelta:function(t){var e=l.a.utc(),n=l.a.utc(t),r=n.diff(e,"minutes");return l.a.duration(r,"minutes").humanize(!0)},returnPostLink:function(t,e){return"/@"+t+"/"+e},refresh:function(){this.loggedInUser&&this.$store.dispatch("hive/getAccount",this.loggedInUser)},init:function(){var t=this;return c()(a.a.mark((function e(){return a.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getRewardFundPost();case 2:return e.next=4,t.getMedianPrice();case 4:t.loggedInUser&&t.$store.dispatch("hive/getAccount",t.loggedInUser);case 5:case"end":return e.stop()}}),e)})))()}},mounted:function(){document.title="Downvoter",this.init()}},h=d,p=n("2877"),g=n("9989"),v=n("f09f"),f=n("a370"),m=n("27f9"),_=n("9c40"),w=n("6b1d"),b=n("58a8"),P=n("1c1c"),k=n("66e5"),y=n("4074"),I=n("0016"),q=n("eaac"),x=n("3b73"),F=n("eebe"),U=n.n(F),Q=Object(p["a"])(h,r,s,!1,null,null,null);e["default"]=Q.exports;U()(Q,"components",{QPage:g["a"],QCard:v["a"],QCardSection:f["a"],QInput:m["a"],QBtn:_["a"],QLinearProgress:w["a"],QBadge:b["a"],QList:P["a"],QItem:k["a"],QItemSection:y["a"],QIcon:I["a"],QTable:q["a"],QExpansionItem:x["a"]})}}]);