(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[28],{"550a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"flex q-pa-md flex-center"},[n("q-card",[n("q-card-section",[t._v("\n      Export account history for tax purposes\n      "),n("q-input",{attrs:{label:"Enter username"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),n("q-btn",{attrs:{label:"Analyse",color:"primary","no-caps":"",dense:"",glossy:""},on:{click:function(e){return t.init()}}})],1),n("q-card-section",[n("q-table",{attrs:{dense:"",title:"Account change by day",data:t.hiveTransactionsByDayTotal,columns:t.columns,separator:"cell","row-key":"date",loading:t.loading},scopedSlots:t._u([{key:"loading",fn:function(){return[n("q-inner-loading",{attrs:{showing:"",color:"secondary"}})]},proxy:!0},{key:"top-right",fn:function(){return[n("q-btn",{attrs:{color:"orange","icon-right":"archive",label:"Export csv",dense:"",glossy:"","no-caps":""},on:{click:t.exportTable}})]},proxy:!0}])}),t.globalProps?n("div",[t._v("vests to hive 473719.109 "+t._s(t.vestToHive(473719.109)))]):t._e()],1),t.hiveTransactions.length>0?n("q-card-section",[t._v("\n      "+t._s(t.hiveTransactions.length)+" tx found\n      "),n("q-btn",{staticClass:"q-ma-md",attrs:{label:"Load 1000 tx",color:"primary",dense:"","no-caps":"",glossy:""},on:{click:function(e){return t.getHiveWalletTransactions()}}}),n("q-btn",{staticClass:"q-ma-md",attrs:{label:"Load 10,000 tx",color:"primary",dense:"","no-caps":"",glossy:""},on:{click:function(e){return t.getBatchTx(10)}}})],1):t._e(),n("q-card-section",[n("q-expansion-item",{attrs:{label:"raw tx"}},[t._v("\n        "+t._s(t.hiveTransactions)+"\n      ")]),n("q-expansion-item",{attrs:{label:"rendered"}},[n("accountOperations",{attrs:{accountOperations:t.hiveTransactions}})],1),n("q-expansion-item",{attrs:{label:"tx by day"}},t._l(t.hiveTransactionsByDayTotal,(function(e){return n("div",{key:e.index},[t._v("\n        "+t._s(e)+"\n        ")])})),0)],1)],1)],1)},s=[],r=n("967e"),i=n.n(r),o=(n("6762"),n("2fdb"),n("4db1")),c=n.n(o),l=(n("96cf"),n("fa84")),u=n.n(l),d=(n("7f7f"),n("20d6"),n("28a5"),n("1c16")),h=n("a357"),f=n("c1df"),p=n.n(f),v=n("be48"),m=n("d1f4"),g=m["ChainTypes"].operations,b=Object(m["makeBitMaskFilter"])([g.transfer,g.transfer_to_vesting,g.withdraw_vesting,g.interest,g.transfer_to_savings,g.transfer_from_savings,g.fill_convert_request,g.fill_order,g.claim_reward_balance,g.producer_reward]);function y(t,e){var n=void 0!==e?e(t):t;return n=void 0===n||null===n?"":String(n),n=n.split('"').join('""'),'"'.concat(n,'"')}var _={name:"tax",components:{accountOperations:v["a"]},data:function(){return{username:this.$router.currentRoute.query.user||null,hiveTransactions:[],bitmask:b,accountHistoryPointer:-1,accountHistoryLimit:1e3,loading:!1,columns:[{name:"date",required:!0,label:"DATE (YMD)",field:function(t){return t.date}},{name:"hive",label:"HIVE",field:function(t){return t.hive}},{name:"hbd",label:"HBD",field:function(t){return t.hbd}},{name:"vests",label:"VESTS",field:function(t){return t.vests}}]}},computed:{loggedInUser:{get:function(){return this.$store.state.hive.user.username}},hiveTransactionsByDay:function(){if(this.hiveTransactions.length>0){var t=[],e=this.hiveTransactions,n=new p.a(e[0][1].timestamp).format("YYYYMMDD"),a=n;return e.forEach((function(e){a=new p.a(e[1].timestamp).format("YYYYMMDD"),0===t.filter((function(t){return t.date===a})).length?t.push({date:a,transactions:[e[1].op]}):t[t.findIndex((function(t){return t.date===a}))].transactions.push(e[1].op)})),t}return[]},hiveTransactionsByDayTotal:function(){var t=this;if(this.hiveTransactions.length>0){var e=0,n=0,a=0,s=[];return this.hiveTransactionsByDay.forEach((function(r){e=n=a=0,console.log("Adding transactions for "+r.date),r.transactions.forEach((function(s){var r=s[1];switch(s[0]){case"claim_rewards_balance":r.account===t.username&&("0.000 HIVE"!==r.reward_hive&&(e+=parseFloat(r.reward_hive.split(" ")[0])),"0.000 HBD"!==r.reward_hbd&&(n+=parseFloat(r.reward_hbd.split(" ")[0])),"0.000 VESTS"!==r.reward_vests&&(a+=parseFloat(r.reward_vests.split(" ")[0])));break;case"producer_reward":r.producer===t.username&&(a+=parseFloat(r.vesting_shares.split(" ")[0]));break;case"transfer":if(r.from===t.username&&r.to!==t.username)switch(r.amount.split(" ")[1]){case"HIVE":e-=parseFloat(r.amount.split(" ")[0]);break;case"HBD":n-=parseFloat(r.amount.split(" ")[0]);break}if(r.to===t.username&&r.from!==t.username)switch(r.amount.split(" ")[1]){case"HIVE":e+=parseFloat(r.amount.split(" ")[0]);break;case"HBD":n+=parseFloat(r.amount.split(" ")[0]);break}break}})),s.push({date:r.date,hive:e.toFixed(3),hbd:n.toFixed(3),vests:a.toFixed(3)})})),s}return[]}},methods:{getBatchTx:function(t){for(var e=2e3,n=0;n<t;n++)setTimeout(function(){this.getHiveWalletTransactions()}.bind(this),n*e)},exportTable:function(){var t=this,e=[this.columns.map((function(t){return y(t.label)}))].concat(this.hiveTransactionsByDayTotal.map((function(e){return t.columns.map((function(t){return y("function"===typeof t.field?t.field(e):e[void 0===t.field?t.name:t.field],t.format)})).join(",")}))).join("\r\n"),n=Object(h["a"])("account-history-export.csv",e,"text/csv");!0!==n&&this.$q.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},getAccount:function(t){void 0===this.$store.state.hive.accounts[t]&&this.$store.dispatch("hive/getAccount",t)},vestToHive:function(t){return this.globalProps.empty?null:this.$hive.formatter.vestToHive(t,this.globalProps.total_vesting_shares,this.globalProps.total_vesting_fund_hive).toFixed(3)},init:function(){this.hiveTransactions=[],this.getHiveWalletTransactions()},getHiveWalletTransactions:function(){var t=this;return u()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$hive.api.callAsync("call",["database_api","get_account_history",[t.username,t.accountHistoryPointer,t.accountHistoryLimit].concat(c()(t.bitmask))]).then((function(e){t.accountHistoryPointer=parseInt(e[0][0])-1,0===t.hiveTransactions.length?t.hiveTransactions=e.reverse():t.hiveTransactions=t.hiveTransactions.concat(e.reverse()),t.loading=!1})).catch((function(e){t.loading=!1,console.log(e),e.data.stack[0].data.sequence&&e.cause.message.includes("Could not find filtered operation in")&&(t.accountHistoryPointer=e.data.stack[0].data.sequence,Object(d["a"])(t.getHiveWalletTransactions(),100))}));case 3:case"end":return e.stop()}}),e)})))()}},mounted:function(){document.title="Tax export view ",this.$store.dispatch("hive/getGlobalProps"),this.username&&this.getHiveWalletTransactions()}},T=_,x=n("2877"),w=n("9989"),k=n("f09f"),q=n("a370"),H=n("27f9"),D=n("9c40"),B=n("eaac"),E=n("74f7"),F=n("3b73"),I=n("eebe"),P=n.n(I),Y=Object(x["a"])(T,a,s,!1,null,null,null);e["default"]=Y.exports;P()(Y,"components",{QPage:w["a"],QCard:k["a"],QCardSection:q["a"],QInput:H["a"],QBtn:D["a"],QTable:B["a"],QInnerLoading:E["a"],QExpansionItem:F["a"]})}}]);